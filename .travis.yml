env:
  global:
  - secure: dYKB7GAEFw9BHjKNryGYJ7612WqjgnQ8oS5ZT4nRoKaNguzpgQTIswvzY8pbg3o606hO2BDwhtGVF8zimqprMcs3AQr7UgdNUBNmR4xRzlwXFMfrMk87J/lP1mGUhQpjoXXW4mVP3MM1cH+lpWR+u1zUY5MeFR3yufs1nMtsbYRvxvqac8bv5lugoGPnGHtHmQ5Vvai9y7f19RhU0rlnUeVVxk4n0TJIIvsb0p2+N1CF/6T+cPY96E2O5iBi/A23tqeY66hQzytLj4zLwRNimI6tLdCaQKYAqEhbJJ2HFAQIIdX52RJI/o6ELOJnUigB9/tOsbjElH8ei7SHju4vmzlPOyLI88XLElGPWhqRcHTBIMSEIBgDnWNXj/nupy9DtApZG548GAaFAJm83PPgtZzT1aXLQh2unDDzkQFqnextbDgmGIBYfm6r7vRq13cl0Bu3R50qZQ9vVrdINYY/ssSdm3qxLOyps8NrTWR8Xq4h3W/voi2mThPiZhnSDrXN7y+HD/Kb8mCCYCzOYMHJCU6IeJ255CCTNx/PULFNHUduwcZNYS0gT+iYEy8WgwnTGQf7WNAPOD25UBR+d56BBeynNjs9UcOolPcRlOYIGzaIxkAi4DWsaofPjGvuvrpIC9lPWGVFFmOg4CHMUmhB1r21iTdZY08+KIBe5JWC2hE=
  - secure: jWqdBRIT59bKWjjcMBzXp2XdOVuvi//Ff2Q2OUxuCQjDRwemZtp57CeoC/NyT2q3Jzo2bPoNrKZYO8QD/9fJOsiYvReDzKBIZJLlR0nikpLUWdYemRq4z6+i3i+KP7DyftcfB+/tyqALNjkzoqEbmocWRqfUhMzjWWli22Ci67VTvQR6RM8amMWrVICd40YZMyg00e2zMGYFglZHA2lXRMufBJENsnUxoEt1y+kCZv5goFESOLMuVO/vnqbg9j5vrS/Vy4Vx4zT/sLIvMxkQEiUwvIQf/n/27TJZXIhOEeihFAXo3G2OgBI97u9FM2bBJrv8o+Of4N5r+q3ZoeBtIuZpR7wPWZHkLQbtxIixVpXNJtQhZmTj61shjRZmh6Sy1OEjFdrVIK3Mk7MY2jnRe8FwXJt3tSAXM/ZM38d4S4I2BEzZJiAvUg3iseXfNx+CDovmYg49HlCmT218CQK7mzU3cvgGAizijjOcUEdRUhnSPQCkVIZhkdJpqGQ2949JTb7bGpYEBdrEnBj10JDjxviDrg6MoI5OmJ8pyIxGoLuL2E8ZX6eCMdAGohw5wb+KL/jfFBmkFjWkHxGD3+3ehNmmMwV0ck0pJYxOvDt5v1wjDWKZpFxosSZ8nBG2VwyiZFZIAt7tZoIn7eG3SZ2moc0TjUEkl5DatOgiFHWZmVo=
  - secure: 2PKrWPPpKHt9LgGLbhfFB0cyk4SFx9ZYCHV1LStV8+sypsKVy/xOtFez+6B3T3vccb+kM+oOttQ/r2AO0BNhN3+OXC+AEu7nEa49zRILx05yVzLEXAbgXpG6Zzb2c15Q5fKN5GcVSs7D/udY1JJfmNXzrEflOvP5I9Uvw4QYjUsO9E+xCJaXswxGdSSNydlVsmbSJi4DC9+zAWalptprS4lp+4wxU28q05ozm7gCeKEIq2WOpNUyPthlZTnIES888oyUHI2D71J/xkPZtoxL0y6/2cLCsa8E51CR6xyHW2xNOpqdmOZR3CUkJrqyT7vQ5ygJrvvWqwPxF8m6f0cfi6IttB3IHI76/Onf5wzlU/8aNqxm1XfNEM7OeVgnP4CfX65xLbZomhuEATOxlTPy5ql3Iuq9eEuANbEoHOGRl7DEdfgfJ8sl4JrQiARUtPqEs/cXn4BwjpZK/JVymHtQaJhof2PlN+maWHaqL0r3daPxga6ukGB1uamXKkuS0wh2Fbx9yUzitsNJ5N6e6rzsH7rg1YE8dVU8jCLkJgLK/Munv/f+wwR6s7N+8QzDPSmZ47YCqP2pYNGOIls13s6oBaixPYiMaiLO6lQiQWOGU/0tNSetQaP20D5OO4SxP0LIuzIax/ecseb0kR1bBV6PZvLZkg9l+vK9+ayh76vo1QQ=
  - secure: kDOrhVaMyb1PJ6m/42YCuoDVs+qWzEjFbcAqom+pp+wfF5JMfbje3leXfKweERlMULVGzWFeY/JjkFPfmTzJvMOKIEi3EqxjjipDe/7ywMwqvneZX+qWAdybwg6yD/yOxz2L5MJnUEZhBMXr3BU1U0UvKy0Zw4xf3zBJ/LsMv+aYa62Gr6syckFSxtsayP/RKc+FtAAozZ53BNRHTjKtcKCdkH8vpZ9xKN+1tZpUMiyfDEZ2a5H+xexMOSLLzCnyUdRA1N51N3bSYsxU0ea9LHtpzKvivnGu9MsAsdToBj8R2Bj6wHZNixo0SdP6NqmRR6aM6cN4uoWP/jsGOm50o1Mf3aY+uM5ELunbWXlvVQc0yjWCbUgIleiYtG3ZD7bj2MsgB/BvG2oOu7nzMrI6KOlv1cDytilaziQlL+oC2Ap+9ThP/czYO4nudPclCmbmNUTGPepKprb8lVXWQXu5YrmUbzvnE1IpuhN2kUxIG39PvVp8aiefy3pNdZAOLnekJAzQCfa7hd08aVn1Oj8xy8JBK+O5b2J4LJ4ULvBkXpzfPWQOJcTFo3L+UhJ6Oih3fx5gv38qznioFW+0bytVF1lQaflvVNjxG+zi+pHNWYff1DBWPqN0rNjoSUYg26efeBSSptUX95kprcbWC5nziPADaVpZgxRhLr5RjPrbyDs=
  - secure: ACRFG9mZOBhXYpMjMiwVwzv1Vv8mGgZCL/qC0a5x5X/qF7USyBTG45wwV8BnDQQGDgaZAB1WMHaYfZfXMdivXZdC2lVBvLZ25mJDw0rpJAPvjKSbtq4RMNJl9glzEoyjSiODqGKjkOWcpxqr10zAjDPuLlUua1kLhe0NR6ozwzj63/qeElo5wzGKXsrIE4P0DhCU3qWm8p3glU/ObAkufWo6xh7mgG1aNXIJMYwXXQujUs99i2NWzZLK6pKlbP9eIh9A33AgLJtwfuIMO4gJV8dDUn0OnAmwF9kXajscUGshsT6ktVeLb5Bq/dx9HBdAGREYan4Imfwd2o9d+Vb/UBqQHBix4g2iuHuxWICWF8HSIeGdBVE2n6XVfc/27qMx+cIQCAv3/IFtN1xJQcA58SyKM8NSRkODfRgWMiYjxPyLAKfrs9wpIATVL1Mnow7UNqxkROvVatYOW7ZkJ19K7/mEZW6fUIbzA8Jt+3TPJH0IYeLZ2r6to5pQ68jSCXlLOgmNpj21G0dOfbJj25iE62E0GT9Qb/+kAerZT2xb/DNo4l0Jn97SlMPECCCDmDFvGlkscD/ZRGGxN/RTZWoPmLbAnZnbO2SiXG9HF0ywhBpUExE2/+cVCp3DrvdHdN6GcYbDgAlyiOOvmadah/u/wPtrJ9zoVFH3j4K7uklPi8c=
  - secure: RE6YRfudFy5TiIO9tJXKqfrgAM/kELMzHqbAsXrsLegE+BNk+XCD4UJ8K6sY7Rkrfod+0p7/G512b3DNaL0N1BMs+tW4TncrbwVX2+d8l30TgYzZlylUdeB0rfTVQWR/cbS6GewwW5DYJwfYQkv37gatMzQhoejeWSJZBBr4JKpmd+T0NPUKPp6OjECjHYuJ7qpOWo5pfYc0bwYzFMF0LMT2jyi8JdayzKtuwy51h47/g5OqQHVIlbPxmfrnXgkXVoZX8XIjJUDztxds914qs6zwM0QRxAxdw6xklwdZArDHQ1t5TB5Yj17EZVTv5z6V9QPOJKM7xbjUkkdKp8lluotO/ZJzoZ92KGtSufy9YIRa0yh09KhFlRhol7PMApY2OI0iyl6NRRHqpXoTiNZC+lc+yrw2w7j8b8Gnvn+7+tvGBfwBMupLwvLyxtEL3lOxHFWghLpNUNhEzZEed5DSAI+oOaKr5rxHpZDh6K6TKSp3FRTjXbosf3+1fqXC93u4RYW72CaccjYThTguSExktQnQl5hga68Cwhn864nv4R8h14rBatNB6UeXW9WmParV/z3vu4QNAV1i02tw9DcOVUM/Z+4Tm1kI7aJN3ox2rIbnSzWOn6/AbgxTnnjzNZUWJi9IIPiRMHk1XoK0DffasXXerQ6IOKb8cB463gItors=
jobs:
  include:
  - stage: Build test image
    name: Build test image
    script: docker build --target test --tag todo-app-test .
  - stage: Tests
    name: Unit
    script: docker run todo-app-test tests
  - script: docker run -e TRELLO_BOARD_ID -e TRELLO_API_KEY -e TRELLO_SERVER_TOKEN todo-app-test tests_e2e
    name: e2e
  - stage: Build prod image
    name: Build prod image
    script: docker build --target prod --tag waormd/todo-app-prod:$TRAVIS_COMMIT --tag waormd/todo-app-prod:latest .
  - stage: Push prod image
    name: Push prod image
    script: echo $DOCKER_PASSWORD | docker login --username $DOCKER_USERNAME --password-stdin && \ 
            docker push waormd/todo-app-prod:$TRAVIS_COMMIT && \ 
            docker push waormd/todo-app-prod:latest
